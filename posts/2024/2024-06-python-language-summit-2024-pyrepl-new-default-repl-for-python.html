<!DOCTYPE html>
<html lang="en" data-accent-color="indigo" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>The Python Language Summit 2024: PyREPL – New default REPL written in Python - Python Blog</title><link rel="shortcut icon" href="../../_static/badge.svg"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=301e5329" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    



</head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../_static/badge.svg" alt="Python Blog" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/badge.svg" alt="Python Blog" height="28" loading="lazy" />
      <strong>Python Blog</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../index.html">Home</a></li>
      <li class="link"><button type="button">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://www.python.org/dev/">
                <span>Contributing</span>
                <small>Learn how to contribute to the Python project</small>
              </a></li><li><a href="https://policies.python.org/python.org/code-of-conduct/">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Python community</small>
              </a></li><li><a href="https://www.python.org/dev/security/">
                <span>Security</span>
                <small>Overview of PSFs's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://www.python.org/psf-landing/">
                <span>Python Software Foundation</span>
                <small>Details about the PSF</small>
              </a></li><li><a href="https://www.python.org/downloads/">
                <span>Releases</span>
                <small>Explore the latest Python releases</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://discord.gg/python">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://discuss.python.org/">
                <span>Board Discussions</span>
                <small>Board Discussions</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/python">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div><div class="sy-container mx-auto body">
    <main class="sy-content mx-auto pt-12 px-6 xl:px-12 break-words">
      <article class="yue" role="main">
        
<section id="the-python-language-summit-2024-pyrepl-new-default-repl-written-in-python">
<h1>The Python Language Summit 2024: PyREPL – New default REPL written in Python<a class="headerlink" href="#the-python-language-summit-2024-pyrepl-new-default-repl-written-in-python" title="Link to this heading">¶</a></h1>
<p><em>This was originally posted on blogger</em> <a class="reference external" href="https://pyfound.blogspot.com/2024/06/python-language-summit-2024-pyrepl-new-default-repl-for-python.html">here</a>.</p>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjBl46EDVOvlYeI9mLrRk0O66qjd4kt3EOUIUcTF1dBwJibsg8IuJV2YnG3ssJzQpnqlKtGfEGeIt4WMKlC4zy36CkHaIUpbFSG_NLSPM9YL6GFU9cUoewDn1A2IY8hWfGEtIfY9IHo1-sihJA8rwbS2cTwiNKKK_cpvhflDM16G-Inhf6zw/s320/20240515_140951.jpg">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjBl46EDVOvlYeI9mLrRk0O66qjd4kt3EOUIUcTF1dBwJibsg8IuJV2YnG3ssJzQpnqlKtGfEGeIt4WMKlC4zy36CkHaIUpbFSG_NLSPM9YL6GFU9cUoewDn1A2IY8hWfGEtIfY9IHo1-sihJA8rwbS2cTwiNKKK_cpvhflDM16G-Inhf6zw/s4000/20240515_140951.jpg">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjjBl46EDVOvlYeI9mLrRk0O66qjd4kt3EOUIUcTF1dBwJibsg8IuJV2YnG3ssJzQpnqlKtGfEGeIt4WMKlC4zy36CkHaIUpbFSG_NLSPM9YL6GFU9cUoewDn1A2IY8hWfGEtIfY9IHo1-sihJA8rwbS2cTwiNKKK_cpvhflDM16G-Inhf6zw/s4000/20240515_140951.jpg</a>)
—
Lysandros showing the mistake we’ve all made, no longer a problem in the new
REPL
(Photo credit: Hugo van Kemenade)</p>
<p>One of the <a class="reference external" href="https://docs.python.org/3.13/whatsnew/3.13.html#whatsnew313-better-interactive-interpreter">headline features of Python
3.13</a> is the new interactive interpreter, sometimes known
as a “REPL” (Read-Evaluate-Print-Loop) which was
<a class="reference external" href="https://github.com/python/cpython/issues/111201">contributed</a> by Pablo
Galindo Salgado, Łukasz Langa, and Lysandros Nikolaou and based on the <a class="reference external" href="https://www.pypy.org/">PyPy
project</a>’s own interactive interpreter, PyREPL. Pablo,
Łukasz, and Lysandros all were at the Language Summit 2024 to present about
this new feature coming to Python.</p>
<section id="why-does-python-need-a-new-interpreter">
<h2>Why does Python need a new interpreter?<a class="headerlink" href="#why-does-python-need-a-new-interpreter" title="Link to this heading">¶</a></h2>
<p>Python already has an interactive interpreter, so why do we need a new one?
Lysandros explained that the existing interpreter is “deeply tangled” to
Python’s tokenizer which means adding new features or making changes is
extremely difficult.</p>
<p>To lend further color to this point, Lysandros dug into how the tokenizer had
changed since Python was first developed. Lysandros noted that “for the first
12 years [of Python], Guido was the only one who touched the tokenizer” and
only later after the parser was replaced did anyone else meaningfully
contribute to the tokenizer.</p>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgN0vlG40dCudDiNJmJkmJie-v5L2tj14bf56BZhVh5Y5FgoXstLPTRJGizg-HUNSiTT-y5PdbDc8SH2xxl6PLptEeMLmZp-rtaJOWj1MXblEoAnZNsrOecNMOItPrG766TSY4TWVkMak2geSMt0o8wwHdiu1ffVrVGYdamclMh2tFkdeRIRg/s320/Screenshot%20from%202024-05-29%2014-23-55.png">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgN0vlG40dCudDiNJmJkmJie-v5L2tj14bf56BZhVh5Y5FgoXstLPTRJGizg">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgN0vlG40dCudDiNJmJkmJie-v5L2tj14bf56BZhVh5Y5FgoXstLPTRJGizg</a>-
HUNSiTT-y5PdbDc8SH2xxl6PLptEeMLmZp-
rtaJOWj1MXblEoAnZNsrOecNMOItPrG766TSY4TWVkMak2geSMt0o8wwHdiu1ffVrVGYdamclMh2tFkdeRIRg/s1195/Screenshot%20from%202024-05-29%2014-23-55.png)
—
Terse example code for Python’s tokenizer</p>
<p>Meanwhile, there are other REPLs for Python that “have many new features that
[Python’s] interpreter doesn’t have that users have grown to expect”,
Lysandros explained. Some basic features that were listed as examples included
lack of color support meaning no syntax highlighting, the ergonomics issues
around exit versus exit(), no support for multi-line editing and buffer
history, and poor ergonomics around pasting code into the interpreter.</p>
</section>
<section id="why-pyrepl">
<h2>Why PyREPL?<a class="headerlink" href="#why-pyrepl" title="Link to this heading">¶</a></h2>
<p>“We’ve settled on starting our solution around PyREPL”, Pablo explained, “our
reasoning being that maintaining terminal applications is hard. Starting from
scratch would have a much higher risk for users”. Pablo also noted that “most
people who would interact with the REPL wouldn’t test in betas”, because
Python pre-releases are generally used for running automated tests in
continuous integration and not interactively tested manually.</p>
<p>Pablo explained that there are many different terminals and platforms which
are all sources of behaviors and bugs that are hard to get right the first
time. “[PyREPL] provided us with a solid base that we know works and we can
start modifying”.</p>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjEEE9xoCPFmO1z93-3b68hgQIGUNzt-XTJucAyskU3NzK84cPoG9WkYaW6gwki9xmuqSujNZ9hzPNzzk_Qj9bAY8dUNjmZrl5C98PJpxWbuGrwbyt6mzs8eH2zooeZxbTJ2yG4mdzydMXfufk61kSRarwu2bey9Id3MH4Rw2E5MFboedhF_w/s320/Screenshot%20from%202024-05-29%2014-58-33.png">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjEEE9xoCPFmO1z93-3b68hgQIGUNzt">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjEEE9xoCPFmO1z93-3b68hgQIGUNzt</a>-
XTJucAyskU3NzK84cPoG9WkYaW6gwki9xmuqSujNZ9hzPNzzk_Qj9bAY8dUNjmZrl5C98PJpxWbuGrwbyt6mzs8eH2zooeZxbTJ2yG4mdzydMXfufk61kSRarwu2bey9Id3MH4Rw2E5MFboedhF_w/s1439/Screenshot%20from%202024-05-29%2014-58-33.png)
—
Tasteful modern art or bug in the REPL?</p>
<p>Another major contributing factor was that PyREPL is written in Python. Pablo
emphasized that “now people that want to start contributing to the REPL can
actually contribute because it’s written in Python”.</p>
<p>Finally, Pablo pointed out that because the implementation is now partially
shared between CPython and PyPy that both implementations can benefit from bug
fixes to the shared parts of the codebase. Support for Chinese characters in
the REPL was fixed in CPython and is being contributed back to PyPy.</p>
<p>Łukasz noted that adopting PyREPL wasn’t a straightforward copy-paste job,
there were multiple ideas in PyPy’s PyREPL that don’t make sense for CPython.
Notably, PyPy is written to also support Python 2, so the code was simplified
to only handle Python 3 code. PyREPL for PyPy also came with support for
PyGame which wasn’t necessary for CPython.</p>
<p>Type hints and strict type checking using <a class="reference external" href="https://mypy-lang.org/">mypy</a> were
also added to PyREPL, making the PyREPL module the <a class="reference external" href="https://github.com/python/cpython/tree/main/Lib/_pyrepl">first in the Python
standard library</a> to
be type-checked on pull requests. Adding type hints to the code immediately
found bugs which were fixed and reported back to PyPy.</p>
</section>
<section id="what-are-the-new-features-in-3-13">
<h2>What are the new features in 3.13?<a class="headerlink" href="#what-are-the-new-features-in-3-13" title="Link to this heading">¶</a></h2>
<p>Pablo gave a demonstration of the new features of PyREPL, including:</p>
<blockquote>
<div><ul class="simple">
<li><p>Colored prompts</p></li>
<li><p>F1 for help, F3 for bracketed paste</p></li>
<li><p>Multi-line editing and history</p></li>
<li><p>Better support for pasting blocks of code</p></li>
</ul>
</div></blockquote>
<p>Below are some recreated highlights from the demo. Pasting code samples into
the old REPL that contain multiple newlines would often result in SyntaxErrors
due to multiple newlines in a row resulting in that statement being evaluated.
Multi-line editing also helps modifying code all in one place rather than
having to piece a snippet together line-by-line, modifying what you want as
you go:</p>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOmyWRdLgCGdtM4Kvz4j5A4qh6_7t-2Jei0ArpdDmvlnWupnnIgsnG-aeekdkq9_9qcKN1F7Quu-ZweP3SMEEt5Kpo-Bl6j_sqZHcTq-VDmNlqbS8uW9SJa3GlvE6VGGo8joyXaHqVH5HpFuGyBlSbVxJwn5o-gQagi-WuSFhENUahSwl0_Q/w640-h382/try4.gif">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOmyWRdLgCGdtM4Kvz4j5A4qh6_7t-2Jei0ArpdDmvlnWupnnIgsnG">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiOmyWRdLgCGdtM4Kvz4j5A4qh6_7t-2Jei0ArpdDmvlnWupnnIgsnG</a>-
aeekdkq9_9qcKN1F7Quu-ZweP3SMEEt5Kpo-Bl6j_sqZHcTq-
VDmNlqbS8uW9SJa3GlvE6VGGo8joyXaHqVH5HpFuGyBlSbVxJwn5o-gQagi-
WuSFhENUahSwl0_Q/s987/try4.gif)
—
Demo of multi-line paste in Python 3.13</p>
<p>And the “exit versus exit()” paper-cut has been bothering Python users for
long enough. This error was especially taunting because the REPL clearly knows
what your intent is with it’s helpful message to “Use exit() to exit”:</p>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjgWz3R7HEvuVpbMSpHID-9JWA2sGqwTzAO3zXfHJ7fCv3_pWB7cSSQkyLuzRo1Jxr98OOnzXNh4kh00zDh_0wIQfruSsVJl0V0tGZMIe-JZ0IdE5LG45RGOILYOPb3yvWNP7Ab03QPpQVH5FVh-7v1cuVmC5Q-oRhU9u26JnB-ef4zbTlVOA/w640-h200/try3.gif">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjgWz3R7HEvuVpbMSpHID-9JWA2sGqwTzAO3zXfHJ7fCv3_pWB7cSSQkyLuzRo1Jxr98OOnzXNh4kh00zDh_0wIQfruSsVJl0V0tGZMIe">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjgWz3R7HEvuVpbMSpHID-9JWA2sGqwTzAO3zXfHJ7fCv3_pWB7cSSQkyLuzRo1Jxr98OOnzXNh4kh00zDh_0wIQfruSsVJl0V0tGZMIe</a>-
JZ0IdE5LG45RGOILYOPb3yvWNP7Ab03QPpQVH5FVh-7v1cuVmC5Q-oRhU9u26JnB-
ef4zbTlVOA/s987/try3.gif)
—
“exit” without parenthesis just works, finally!</p>
</section>
<section id="windows-and-terminals">
<h2>Windows and terminals<a class="headerlink" href="#windows-and-terminals" title="Link to this heading">¶</a></h2>
<p>Support is already available for Unix consoles (Linux and macOS) in Python
3.13.0-beta1 and the standout feature request so far for PyREPL has been
Windows support. Windows was left out because “historically the console on
Windows was way different than Unix consoles”. Łukasz continued, saying that
“they don’t intend to support right now” offering a “yes, but…” for users
asking for Windows support.</p>
<p>Windows has two consoles today, cmd.exe of yore and the new “Windows Terminal”
which supports many of the same features as Unix consoles including <a class="reference external" href="https://en.wikipedia.org/wiki/ANSI_escape_code">VT100
escape codes</a>. The team’s plan
is to support the new Windows Terminal, and “to use our sprints here in
Pittsburgh to finish”. Windows support will also require removing CPython
dependencies on the
<a href="#id6"><span class="problematic" id="id7">`curses &lt;https://en.wikipedia.org/wiki/Curses_\(programming_library\&gt;`_</span></a>) and
<a class="reference external" href="https://en.wikipedia.org/wiki/GNU_Readline">readline</a> libraries.</p>
</section>
<section id="what-s-next-for-pyrepl">
<h2>What’s next for PyREPL?<a class="headerlink" href="#what-s-next-for-pyrepl" title="Link to this heading">¶</a></h2>
<p>The team already has plans cooking up for what to add to the REPL in Python
3.14. Łukasz commented that “syntax highlighting is an obvious idea to
tackle”. Łukasz also referenced an idea from Tania Allard for accessibility
improvements similar to those in <a class="reference external" href="https://ipython.org/">IPython</a>.</p>
<p>Łukasz reiterated that the goal isn’t to make an “uber REPL” or “replace
IPython”, but instead to make a REPL that core developers can use while
testing development branches (where dependencies aren’t working yet).</p>
<p>Łukasz continued that core developers aren’t the only ones that these
improvements benefit: “many teachers are using straight-up Python, IDLE, or
the terminal because the computers they’re using don’t allow them to install
anything else.”</p>
<p>Given the applause from the room during the demos, it’s safe to say that this
work has been received well. There were only concerns about platform support
and rollout for the new REPL.</p>
<p>Gregory Smith informed the team that functionality that requires a “Function”
key (ie F1, F2, etc) must also be supported without Function keys due to some
computers lacking them, like Chromebooks.</p>
<p>Carol Willing was concerned about releasing PyREPL without support for Windows
Terminal, especially from a teaching perspective, describing that potential
outcome as “painful”. Carol wanted clear documentation on how to get the new
REPL on Windows. “Positioning [the new REPL] for teaching without clear
Windows instructions is a recipe for disaster”.</p>
<p>Pablo assured that the team wants to add support for Windows Terminal in time
for the first 3.13 release candidate. Pablo could not make guarantees due to a
lack of Windows expertise among the three, saying “the reason I’m not saying
100% is because none of us are Windows experts. We understand what needs to be
done… but we need some help.”</p>
<p>Łukasz named Steve Dower, the Windows release expert for Python, who is “very
motivated to help us get Windows Terminal support during sprints”. Łukasz
reiterated they’re “not 100%, but we are very motivated to get it done”.</p>
<p>Gregory Smith shared Carol’s concern and framed the problem as one of
communication strategy, proposing to “not promise too much until it works
completely on Windows”. By Python 3.14 the flashy features like syntax
highlighting would have landed and the team would have a better understanding
of what’s needed for Windows. The team can revise the 3.13 “What’s New in
Python” depending on what gets implemented in the 3.13 timeline.</p>
<p>Ned Deily sought to clarify what the default experience would be for users of
3.13. Pablo said that “on Windows right now you will get the [same REPL] that
you got before” and “on Linux and macOS, if your terminal supports the
features which most of them do, you get the enhanced experience”. “What we
want in the sprints is to make Windows support the new one, if we get feature
parity, then [Windows] will also get the new [REPL]”.</p>
<p>Carol also asked to document how to opt-out of the new REPL in the case that
support wasn’t added in time for 3.13 to avoid differences between educational
material and what students were seeing in their terminal. Kushal Das confirmed
that differences across platforms is a source of problems for students, saying
that “if all [students] have the same experience it’s much better than just
improving only macOS and Linux” to avoid students feeling bad just due to
their operating system.</p>
<p>Pablo said that the opt-out mechanism was already in place with an environment
variable and will discuss other opt-out mechanisms if needed for educators.</p>
<p>Emily Morehouse, speaking as a Steering Council member added that the Steering
Council has requested an informational PEP on the new REPL. “Hearing concerns
about how [the new REPL] might be rolled out… it sounds like we might need
something that’s more compatible and an easier rollout”, leaving the final
discussions to the 3.13 release manager, Thomas Wouters. Carol replied that
she believes “we could do it in documentation”.</p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    Previous:
    
    <a href="2024-06-python-language-summit-2024-c-api.html">
      
      <span>The Python Language Summit 2024: Native Interface and Limited C API</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
    
    Next:
    
    <a href="2024-06-python-language-summit-2024-python-on-mobile.html">
      <span>The Python Language Summit 2024: Python on Mobile</span>
      
    </a>
    
  </span>
</div>

  
  
</div>

      </article>
      
    </main>
  </div><footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024, Python Software Foundation</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=8a448e45"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/shibuya.js?v=3cc430e2"></script></body>
</html>