<!DOCTYPE html>
<html lang="en" data-accent-color="indigo" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Paul Ganssle: Time Zones In The Standard Library - Python Blog</title><link rel="shortcut icon" href="../../_static/badge.svg"/><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=301e5329" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    



</head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="/">
      <img class="light-logo" src="../../_static/badge.svg" alt="Python Blog" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/badge.svg" alt="Python Blog" height="28" loading="lazy" />
      <strong>Python Blog</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../../index.html">Home</a></li>
      <li class="link"><button type="button">
            <span>Community</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://www.python.org/dev/">
                <span>Contributing</span>
                <small>Learn how to contribute to the Python project</small>
              </a></li><li><a href="https://policies.python.org/python.org/code-of-conduct/">
                <span>Code of Conduct</span>
                <small>Review the etiquette for interacting with the Python community</small>
              </a></li><li><a href="https://www.python.org/dev/security/">
                <span>Security</span>
                <small>Overview of PSFs's security protocols</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>About</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://www.python.org/psf-landing/">
                <span>Python Software Foundation</span>
                <small>Details about the PSF</small>
              </a></li><li><a href="https://www.python.org/downloads/">
                <span>Releases</span>
                <small>Explore the latest Python releases</small>
              </a></li></ul>
      </li>
      <li class="link"><button type="button">
            <span>Help</span>
            <i class="i-lucide chevron-down"></i>
          </button>
        <ul><li><a href="https://discord.gg/python">
                <span>Discord Help Forum</span>
                <small>Dedicated Discord help forum</small>
              </a></li><li><a href="https://discuss.python.org/">
                <span>Board Discussions</span>
                <small>Board Discussions</small>
              </a></li></ul>
      </li><li class="link">
          <a href="https://github.com/sponsors/python">
            <span>Sponsor</span></a>
        </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div><div class="sy-container mx-auto body">
    <main class="sy-content mx-auto pt-12 px-6 xl:px-12 break-words">
      <article class="yue" role="main">
        
<section id="paul-ganssle-time-zones-in-the-standard-library">
<h1>Paul Ganssle: Time Zones In The Standard Library<a class="headerlink" href="#paul-ganssle-time-zones-in-the-standard-library" title="Link to this heading">¶</a></h1>
<p><em>This was originally posted on blogger</em> <a class="reference external" href="https://pyfound.blogspot.com/2019/05/paul-ganssle-time-zones-in-standard.html">here</a>.</p>
<p>Python boasts that it comes with “batteries included,” but programmers have
long been frustrated at one set of missing batteries: the standard library
does not include any time zone definitions. The datetime module supports the
_idea_ of time zones, but a programmer who wants to know when Daylight Saving
Time starts in Cleveland must install a third-party package. Paul Ganssle
spoke to the Python Language Summit to offer a solution. Ganssle maintains the
PyPI package dateutil, and contributes to the standard library datetime
module. He described the state of Python time zone support and how time zone
definitions could be added to the standard library.</p>
<p><a class="reference external" href="https://pyfound.blogspot.com/2019/05/the-2019-python-language-summit.html">Read more 2019 Python Language Summit
coverage</a>.</p>
</section>
<section id="python-comes-with-limited-time-zone-support">
<h1>Python Comes With Limited Time Zone Support<a class="headerlink" href="#python-comes-with-limited-time-zone-support" title="Link to this heading">¶</a></h1>
<p>A time zone is a function that maps a naïve time to an unambiguous Coordinated
Universal Time (UTC). Individual time zones can be quite eccentric, so Python
does not attempt to define time zone logic, it simply provides an abstract
base class TZInfo that is subclassed by implementors. Although there could
theoretically be unlimited kinds of time zones, most programmers encounter
three concrete types:</p>
<p>1. UTC or a fixed offset from it.</p>
<p>2. Local time.</p>
<p>3. A time zone from the <a class="reference external" href="https://en.wikipedia.org/wiki/Tz_database">IANA
database</a>.</p>
<p>The first of these was added to the standard library in Python 3.2. Ganssle
said, “Whenever I teach people about datetimes, it’s really nice to be able to
say, if you’re using Python 3, you can just have a UTC object.” The purpose of
Ganssle’s proposal was to add the second and third.</p>
</section>
<section id="ambiguous-times">
<h1>Ambiguous Times<a class="headerlink" href="#ambiguous-times" title="Link to this heading">¶</a></h1>
<p>Ganssle explained that when Eastern Daylight Time ends, clocks are set back
from 2:00am to 1:00am, thus there are two UTC times that map to 1:30am local
time on that day:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">NYC</span> <span class="o">=</span> <span class="n">tz</span><span class="o">.</span><span class="n">gettz</span><span class="p">(</span><span class="s2">&quot;America/New_York&quot;</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">dt0</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">tz</span><span class="o">.</span><span class="n">UTC</span><span class="p">)</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dt0</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">NYC</span><span class="p">))</span>
</span><span data-line="4"><span class="go">2004-10-31 01:30:00-04:00</span>
</span><span data-line="5"><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">((</span><span class="n">dt0</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">NYC</span><span class="p">))</span>
</span><span data-line="6"><span class="go">2004-10-31 01:30:00-05:00</span>
</span></pre></div>
</div>
<p><a class="reference external" href="https://www.python.org/dev/peps/pep-0495/">PEP 495</a> solved the problem of
ambiguous times by adding the “fold” attribute to datetime objects. A datetime
with fold=0 is the first occurrence of that local time, the second occurrence
has fold=1. With this addition, standard Python provides all the prerequisites
for proper time zones, so Ganssle argued they should now be added to the
standard library.</p>
</section>
<section id="how-to-maintain-the-time-zone-definitions">
<h1>How To Maintain The Time Zone Definitions?<a class="headerlink" href="#how-to-maintain-the-time-zone-definitions" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiL5lRvZsHGGrOmc3g4FtbMXfib5w651GYduMF96UlvFr06j_PwtS5tNjYQFBknoTQYsDMsum0G37k7y9CPq8KaKkCJv_WQ0P_gjFWMRs-nRqGQOTYlJmLaMrpehG-QGPW0KA/s400/paul-ganssle.jpg">![</a>](<a class="reference external" href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiL5lRvZsHGGrOmc3g4FtbMXfib5w651GYduMF96UlvFr06j_PwtS5tNjYQFBknoTQYsDMsum0G37k7y9CPq8KaKkCJv_WQ0P_gjFWMRs">https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiL5lRvZsHGGrOmc3g4FtbMXfib5w651GYduMF96UlvFr06j_PwtS5tNjYQFBknoTQYsDMsum0G37k7y9CPq8KaKkCJv_WQ0P_gjFWMRs</a>-
nRqGQOTYlJmLaMrpehG-QGPW0KA/s1600/paul-ganssle.jpg)IANA time zones are the de
facto standard for time zone data, and they ship with many operating systems.
Both Ganssle’s dateutil and the competing pytz package use the IANA database
as their source of truth. Therefore it would be natural to include the IANA
time zones in the Python standard library, but this presents a problem: the
IANA database changes every time a government changes a time zone, which
occurs as often as 20 times a year. Time zone changes are far more frequent
than Python releases.</p>
<p>Ganssle offered two solutions for updating time zone data, and then offered a
compromise between them as his actual proposal. The first solution is to rely
on the operating system’s time zone database. Python could rely on the system
update mechanism to refresh this data, and it would use the same time zone
definitions as most other applications. System time zone data is not
officially supported on Windows, however, and is not always installed on
Linux.</p>
<p>The second solution is to publish IANA time zone definitions as a PyPI
package. It could be updated frequently, but the core team would have to
invent some way to notify users when it is time to update their time zone
data. Plus, it would be risky for Python to use different time zones than the
rest of the system.</p>
<p>Ganssle proposed a hybrid: the Python standard library should use the system’s
time zone data if possible, otherwise fall back to a PyPI package which would
be installed conveniently, analogous to installing pip with “ensurepip” today.</p>
</section>
<section id="the-local-time-zone">
<h1>The Local Time Zone<a class="headerlink" href="#the-local-time-zone" title="Link to this heading">¶</a></h1>
<p>Naïve times in Python are sometimes treated as times in the local time zone,
sometimes not. Ganssle showed an example demonstrating that if a programmer
converts a naïve time to UTC, Python assumes its original time zone is local:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="3"><span class="go">2020-01-01 17:00:00+00:00</span>
</span></pre></div>
</div>
<p>However, adding a naïve time to a UTC time is prohibited:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="2"><span class="gt">Traceback (most recent call last):</span>
</span><span data-line="3">  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
</span><span data-line="4"><span class="gr">TypeError</span>: <span class="n">can&#39;t subtract offset-naive and offset-aware datetimes</span>
</span></pre></div>
</div>
<p>Ganssle’s dateutil package offers a more thorough implementation of “local
time zone”, and he thinks Python programmers would appreciate local times in
the standard library. To add them, however, the core team must first handle
the astonishing behavior of local times when the system time zone changes. The
first surprise is that changing the system time zone has no effect until the
Python program calls time.tzset(). (And on Windows, time.tzset() is not
available.) The second surprise is that changing system time and then calling
time.tzset() changes the UTC offset of _existing_ times created before the
change.</p>
<p>Ganssle proposed several ways the standard library could act in this scenario.
It could ignore changes to the system time zone while a Python program is
running, or it could detect time zone changes but avoid mutating the offsets
of existing time objects. He had no opinion about the best outcome.</p>
</section>
<section id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">¶</a></h1>
<p>Ned Deily wondered what Ganssle’s proposal would solve that which
<a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> does not. Ganssle responded that pytz’s
author has stopped maintaining the package because he believes time zones
should move to the standard library. Full time zone is a basic feature that
should always be available. In Ganssle’s view, however, his own dateutil is a
better package to emulate than pytz. “I would take dateutil, clean up some of
the rough edges, and propose it as some of the batteries that would be
included.”</p>
<p>Łukasz Langa said that he planned, as Python 3.8’s release manager, to issue
monthly patch releases, and he thought that should be frequent enough to keep
users’ time zone data updated. Russell Keith-Magee said no, <a class="reference external" href="https://www.washingtonpost.com/news/worldviews/wp/2018/05/04/the-brief-history-of-north-koreas-time-zone/?noredirect=on&amp;utm_term=.d329bf1cf474">North Korea once
announced a time zone change with three days’
notice</a>. Other audience members thought
this scenario was obscure, and the PEP should not be required to handle such
emergencies.</p>
<p>At the end of his talk Ganssle summarized his proposal. He believes that the
standard library should support IANA time zones, using the operating system as
the source of time zone data or falling back to a PyPI package. There are
several options for handling local time zone changes at runtime. The design
should be formalized in at least an informational PEP, “if not one where it’s
contentious and we all hate each other at the end of it.”</p>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    Previous:
    
    <a href="2019-05-building-psf-q2-2019-fundraiser.html">
      
      <span>Building the PSF: the Q2 2019 Fundraiser</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
    
    Next:
    
    <a href="2019-05-russell-keith-magee-python-on-other.html">
      <span>Russell Keith-Magee: Python On Other Platforms</span>
      
    </a>
    
  </span>
</div>

  
  
</div>

      </article>
      
    </main>
  </div><footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2024, Python Software Foundation</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=8a448e45"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../_static/shibuya.js?v=3cc430e2"></script></body>
</html>